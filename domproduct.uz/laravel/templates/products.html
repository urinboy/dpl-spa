<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DOM PRODUCT - Mahsulotlar</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#10b981',
                        'primary-dark': '#059669',
                        secondary: '#1f2937',
                        accent: '#f59e0b'
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-50">
    <!-- Navigation Header -->
    <header class="gradient-bg text-white sticky top-0 z-50 shadow-lg">
        <div class="container mx-auto px-4">
            <div class="flex items-center justify-between h-16">
                <!-- Back Button & Title -->
                <div class="flex items-center space-x-3">
                    <button onclick="goBack()" class="p-2 hover:bg-white/20 rounded-lg transition-colors">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                        </svg>
                    </button>
                    <div>
                        <h1 class="text-xl font-bold" id="page-title">Mahsulotlar</h1>
                        <p class="text-xs text-green-200" id="products-count">0 ta mahsulot</p>
                    </div>
                </div>

                <!-- Search & Actions -->
                <div class="flex items-center space-x-4">
                    <!-- Search -->
                    <button onclick="toggleSearch()" class="p-2 hover:bg-white/20 rounded-lg transition-colors md:hidden">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m21 21-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                        </svg>
                    </button>

                    <!-- Filter -->
                    <button onclick="toggleFilters()" class="p-2 hover:bg-white/20 rounded-lg transition-colors">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.207A1 1 0 013 6.5V4z"/>
                        </svg>
                    </button>

                    <!-- Cart -->
                    <a href="cart.html" class="relative p-2 hover:bg-white/20 rounded-lg transition-colors">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4m0 0L7 13m0 0l-1.5 6M7 13l-1.5 6m0 0h9"></path>
                        </svg>
                        <span class="absolute -top-1 -right-1 bg-accent text-xs text-white rounded-full w-5 h-5 flex items-center justify-center" id="cart-count">0</span>
                    </a>
                </div>
            </div>

            <!-- Mobile Search -->
            <div id="mobile-search" class="md:hidden pb-4 hidden">
                <div class="relative">
                    <input type="text"
                           id="mobile-search-input"
                           placeholder="Mahsulotlarni qidiring..."
                           class="w-full px-4 py-2 rounded-lg bg-white/20 text-white placeholder-green-200 border border-white/30 focus:border-primary focus:outline-none">
                    <button onclick="handleMobileSearch()" class="absolute right-2 top-2 text-green-200 hover:text-white">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m21 21-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Filters Sidebar -->
    <div id="filters-sidebar" class="fixed inset-y-0 right-0 w-full md:w-80 bg-white shadow-2xl transform translate-x-full transition-transform duration-300 z-40">
        <div class="flex flex-col h-full">
            <!-- Filter Header -->
            <div class="flex items-center justify-between p-4 border-b">
                <h3 class="text-lg font-semibold">Filtrlar</h3>
                <button onclick="toggleFilters()" class="p-2 hover:bg-gray-100 rounded-lg">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>

            <!-- Filter Content -->
            <div class="flex-1 overflow-y-auto p-4 space-y-6">
                <!-- Price Range -->
                <div>
                    <h4 class="font-semibold mb-3">Narx oralig'i</h4>
                    <div class="space-y-3">
                        <div class="flex space-x-3">
                            <input type="number" placeholder="Dan" id="min-price" class="flex-1 form-input">
                            <input type="number" placeholder="Gacha" id="max-price" class="flex-1 form-input">
                        </div>
                        <div class="flex flex-wrap gap-2">
                            <button onclick="setPriceRange(0, 10000)" class="px-3 py-1 text-sm border border-gray-300 rounded-lg hover:bg-gray-50">0 - 10,000</button>
                            <button onclick="setPriceRange(10000, 50000)" class="px-3 py-1 text-sm border border-gray-300 rounded-lg hover:bg-gray-50">10,000 - 50,000</button>
                            <button onclick="setPriceRange(50000, 100000)" class="px-3 py-1 text-sm border border-gray-300 rounded-lg hover:bg-gray-50">50,000 - 100,000</button>
                        </div>
                    </div>
                </div>

                <!-- Categories -->
                <div>
                    <h4 class="font-semibold mb-3">Kategoriyalar</h4>
                    <div class="space-y-2" id="category-filters">
                        <!-- Category filters will be loaded here -->
                    </div>
                </div>

                <!-- Brands -->
                <div>
                    <h4 class="font-semibold mb-3">Brendlar</h4>
                    <div class="space-y-2">
                        <label class="flex items-center">
                            <input type="checkbox" class="rounded border-gray-300 text-primary brand-filter" value="dom-product">
                            <span class="ml-2 text-sm">DOM PRODUCT</span>
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" class="rounded border-gray-300 text-primary brand-filter" value="local-brand">
                            <span class="ml-2 text-sm">Mahalliy brend</span>
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" class="rounded border-gray-300 text-primary brand-filter" value="imported">
                            <span class="ml-2 text-sm">Import</span>
                        </label>
                    </div>
                </div>

                <!-- Rating -->
                <div>
                    <h4 class="font-semibold mb-3">Reyting</h4>
                    <div class="space-y-2">
                        <label class="flex items-center">
                            <input type="radio" name="rating" value="5" class="text-primary">
                            <span class="ml-2 flex items-center">
                                <span class="text-yellow-400">â˜…â˜…â˜…â˜…â˜…</span>
                                <span class="ml-1 text-sm">5 yulduz</span>
                            </span>
                        </label>
                        <label class="flex items-center">
                            <input type="radio" name="rating" value="4" class="text-primary">
                            <span class="ml-2 flex items-center">
                                <span class="text-yellow-400">â˜…â˜…â˜…â˜…â˜†</span>
                                <span class="ml-1 text-sm">4+ yulduz</span>
                            </span>
                        </label>
                        <label class="flex items-center">
                            <input type="radio" name="rating" value="3" class="text-primary">
                            <span class="ml-2 flex items-center">
                                <span class="text-yellow-400">â˜…â˜…â˜…â˜†â˜†</span>
                                <span class="ml-1 text-sm">3+ yulduz</span>
                            </span>
                        </label>
                    </div>
                </div>

                <!-- Availability -->
                <div>
                    <h4 class="font-semibold mb-3">Mavjudlik</h4>
                    <div class="space-y-2">
                        <label class="flex items-center">
                            <input type="checkbox" class="rounded border-gray-300 text-primary" id="in-stock">
                            <span class="ml-2 text-sm">Faqat mavjud mahsulotlar</span>
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" class="rounded border-gray-300 text-primary" id="on-sale">
                            <span class="ml-2 text-sm">Chegirmadagi mahsulotlar</span>
                        </label>
                    </div>
                </div>
            </div>

            <!-- Filter Actions -->
            <div class="p-4 border-t space-y-3">
                <button onclick="applyFilters()" class="w-full btn btn-primary">
                    Filtrlarni qo'llash
                </button>
                <button onclick="clearFilters()" class="w-full btn btn-secondary">
                    Tozalash
                </button>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-6">
        <!-- Breadcrumb -->
        <nav class="mb-6" id="breadcrumb">
            <ol class="flex items-center space-x-2 text-sm">
                <li><a href="index.html" class="text-gray-500 hover:text-primary">Bosh sahifa</a></li>
                <li><span class="text-gray-400">/</span></li>
                <li><span class="text-gray-700" id="breadcrumb-category">Mahsulotlar</span></li>
            </ol>
        </nav>

        <!-- Sort & View Options -->
        <div class="flex items-center justify-between mb-6">
            <!-- Sort -->
            <div class="flex items-center space-x-4">
                <span class="text-sm text-gray-600">Saralash:</span>
                <select id="sort-select" onchange="handleSort()" class="form-input text-sm">
                    <option value="default">Standart</option>
                    <option value="price-asc">Narx: Arzondan qimmatge</option>
                    <option value="price-desc">Narx: Qimmatdan arzonga</option>
                    <option value="name-asc">Nomi: A-Z</option>
                    <option value="name-desc">Nomi: Z-A</option>
                    <option value="rating">Reyting bo'yicha</option>
                    <option value="newest">Yangi mahsulotlar</option>
                </select>
            </div>

            <!-- View Toggle -->
            <div class="flex items-center space-x-2">
                <button onclick="setView('grid')" id="grid-view" class="p-2 rounded-lg bg-primary text-white">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M3 3h8v8H3V3zm10 0h8v8h-8V3zM3 13h8v8H3v-8zm10 0h8v8h-8v-8z"/>
                    </svg>
                </button>
                <button onclick="setView('list')" id="list-view" class="p-2 rounded-lg bg-gray-200 text-gray-600">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M3 4h18v2H3V4zm0 7h18v2H3v-2zm0 7h18v2H3v-2z"/>
                    </svg>
                </button>
            </div>
        </div>

        <!-- Products Grid/List -->
        <div id="products-container">
            <!-- Loading State -->
            <div id="loading" class="text-center py-12">
                <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary"></div>
                <p class="mt-2 text-gray-600">Yuklanmoqda...</p>
            </div>

            <!-- Products Grid -->
            <div id="products-grid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4 hidden">
                <!-- Products will be loaded here -->
            </div>

            <!-- Products List -->
            <div id="products-list" class="space-y-4 hidden">
                <!-- Products will be loaded here -->
            </div>

            <!-- Empty State -->
            <div id="empty-state" class="text-center py-12 hidden">
                <svg class="w-16 h-16 mx-auto mb-4 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"/>
                </svg>
                <h3 class="text-lg font-semibold text-gray-700 mb-2">Mahsulot topilmadi</h3>
                <p class="text-gray-500 mb-4">Qidiruv parametrlarini o'zgartirib ko'ring</p>
                <button onclick="clearFilters()" class="btn btn-primary">
                    Filtrlarni tozalash
                </button>
            </div>
        </div>

        <!-- Pagination -->
        <div id="pagination" class="flex justify-center mt-8 hidden">
            <div class="flex items-center space-x-2">
                <button onclick="previousPage()" id="prev-btn" class="px-3 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50">
                    Oldingi
                </button>
                <div id="page-numbers" class="flex space-x-1">
                    <!-- Page numbers will be generated here -->
                </div>
                <button onclick="nextPage()" id="next-btn" class="px-3 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50">
                    Keyingi
                </button>
            </div>
        </div>
    </main>

    <!-- Filter Overlay -->
    <div id="filter-overlay" class="fixed inset-0 bg-black bg-opacity-50 hidden z-30" onclick="toggleFilters()"></div>

    <!-- Bottom Navigation (Mobile) -->
    <nav class="md:hidden fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 z-50">
        <div class="flex items-center justify-around py-2">
            <a href="index.html" class="flex flex-col items-center py-2 px-3 text-gray-500">
                <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
                </svg>
                <span class="text-xs mt-1">Bosh sahifa</span>
            </a>
            <a href="categories.html" class="flex flex-col items-center py-2 px-3 text-gray-500">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 10h16M4 14h16M4 18h16"/>
                </svg>
                <span class="text-xs mt-1">Kategoriya</span>
            </a>
            <a href="cart.html" class="flex flex-col items-center py-2 px-3 text-gray-500">
                <div class="relative">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4m0 0L7 13m0 0l-1.5 6M7 13l-1.5 6m0 0h9"/>
                    </svg>
                    <span class="absolute -top-2 -right-2 bg-accent text-xs text-white rounded-full w-4 h-4 flex items-center justify-center">0</span>
                </div>
                <span class="text-xs mt-1">Savat</span>
            </a>
            <a href="search.html" class="flex flex-col items-center py-2 px-3 text-primary">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m21 21-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                </svg>
                <span class="text-xs mt-1">Qidiruv</span>
            </a>
            <a href="profile.html" class="flex flex-col items-center py-2 px-3 text-gray-500">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                </svg>
                <span class="text-xs mt-1">Profil</span>
            </a>
        </div>
    </nav>

    <script>
        // Demo products data
        const productsData = [
            { id: 1, name: "Toza olma", slug: "toza-olma", price: 8000, originalPrice: 10000, image: "ðŸŽ", category: "fruits", categoryName: "Mevalar", unit: "kg", rating: 4.5, reviews: 24, inStock: true, featured: true, brand: "local-brand" },
            { id: 2, name: "Yangi pomidor", slug: "yangi-pomidor", price: 12000, image: "ðŸ…", category: "vegetables", categoryName: "Sabzavotlar", unit: "kg", rating: 4.8, reviews: 18, inStock: true, featured: false, brand: "dom-product" },
            { id: 3, name: "Premium mol go'shti", slug: "premium-mol-goshti", price: 85000, image: "ðŸ¥©", category: "meat", categoryName: "Go'sht", unit: "kg", rating: 4.9, reviews: 12, inStock: true, featured: true, brand: "local-brand" },
            { id: 4, name: "Toza sut", slug: "toza-sut", price: 8500, image: "ðŸ¥›", category: "dairy", categoryName: "Sut mahsulotlari", unit: "litr", rating: 4.6, reviews: 31, inStock: true, featured: false, brand: "dom-product" },
            { id: 5, name: "Issiq non", slug: "issiq-non", price: 3500, image: "ðŸž", category: "bakery", categoryName: "Non", unit: "dona", rating: 4.3, reviews: 45, inStock: true, featured: false, brand: "local-brand" },
            { id: 6, name: "Shirin banan", slug: "shirin-banan", price: 18000, originalPrice: 20000, image: "ðŸŒ", category: "fruits", categoryName: "Mevalar", unit: "kg", rating: 4.7, reviews: 19, inStock: true, featured: true, brand: "imported" },
            { id: 7, name: "Organik sabzi", slug: "organik-sabzi", price: 15000, image: "ðŸ¥•", category: "vegetables", categoryName: "Sabzavotlar", unit: "kg", rating: 4.4, reviews: 13, inStock: false, featured: false, brand: "local-brand" },
            { id: 8, name: "Baliq filesi", slug: "baliq-filesi", price: 45000, image: "ðŸŸ", category: "fish", categoryName: "Baliq", unit: "kg", rating: 4.2, reviews: 8, inStock: true, featured: false, brand: "imported" }
        ];

        let currentProducts = [...productsData];
        let currentView = 'grid';
        let currentPage = 1;
        let itemsPerPage = 12;
        let currentFilters = {
            category: null,
            search: '',
            minPrice: null,
            maxPrice: null,
            sort: 'default',
            brands: [],
            rating: null,
            inStock: false,
            onSale: false
        };

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            parseUrlParams();
            loadProducts();
            updateCartCount();
            loadCategoryFilters();
        });

        function parseUrlParams() {
            const urlParams = new URLSearchParams(window.location.search);
            const category = urlParams.get('category');
            const search = urlParams.get('search') || urlParams.get('q');
            const featured = urlParams.get('featured');

            if (category) {
                currentFilters.category = category;
                updatePageTitle(category);
            }

            if (search) {
                currentFilters.search = search;
                document.getElementById('mobile-search-input').value = search;
            }

            if (featured) {
                currentProducts = currentProducts.filter(product => product.featured);
                document.getElementById('page-title').textContent = 'Tavsiya etilgan mahsulotlar';
            }
        }

        function updatePageTitle(category) {
            const categoryNames = {
                'fruits': 'Mevalar',
                'vegetables': 'Sabzavotlar',
                'meat': 'Go\'sht mahsulotlari',
                'dairy': 'Sut mahsulotlari',
                'bakery': 'Non va g\'alla',
                'drinks': 'Ichimliklar'
            };

            const categoryName = categoryNames[category] || 'Mahsulotlar';
            document.getElementById('page-title').textContent = categoryName;
            document.getElementById('breadcrumb-category').textContent = categoryName;
        }

        function loadCategoryFilters() {
            const categories = [
                { id: 'fruits', name: 'Mevalar', count: 3 },
                { id: 'vegetables', name: 'Sabzavotlar', count: 2 },
                { id: 'meat', name: 'Go\'sht mahsulotlari', count: 1 },
                { id: 'dairy', name: 'Sut mahsulotlari', count: 1 },
                { id: 'bakery', name: 'Non va g\'alla', count: 1 }
            ];

            const container = document.getElementById('category-filters');
            container.innerHTML = categories.map(cat => `
                <label class="flex items-center justify-between">
                    <div class="flex items-center">
                        <input type="checkbox" class="rounded border-gray-300 text-primary category-filter" value="${cat.id}">
                        <span class="ml-2 text-sm">${cat.name}</span>
                    </div>
                    <span class="text-xs text-gray-500">(${cat.count})</span>
                </label>
            `).join('');
        }

        function loadProducts() {
            showLoading(true);

            setTimeout(() => {
                const filteredProducts = getFilteredProducts();
                displayProducts(filteredProducts);
                updateProductsCount(filteredProducts.length);
                updatePagination(filteredProducts.length);
                showLoading(false);
            }, 500);
        }

        function getFilteredProducts() {
            let filtered = [...productsData];

            // Category filter
            if (currentFilters.category) {
                filtered = filtered.filter(product => product.category === currentFilters.category);
            }

            // Search filter
            if (currentFilters.search) {
                const searchLower = currentFilters.search.toLowerCase();
                filtered = filtered.filter(product =>
                    product.name.toLowerCase().includes(searchLower) ||
                    product.categoryName.toLowerCase().includes(searchLower)
                );
            }

            // Price filter
            if (currentFilters.minPrice !== null) {
                filtered = filtered.filter(product => product.price >= currentFilters.minPrice);
            }
            if (currentFilters.maxPrice !== null) {
                filtered = filtered.filter(product => product.price <= currentFilters.maxPrice);
            }

            // Brand filter
            if (currentFilters.brands.length > 0) {
                filtered = filtered.filter(product => currentFilters.brands.includes(product.brand));
            }

            // Rating filter
            if (currentFilters.rating) {
                filtered = filtered.filter(product => product.rating >= parseFloat(currentFilters.rating));
            }

            // Stock filter
            if (currentFilters.inStock) {
                filtered = filtered.filter(product => product.inStock);
            }

            // Sale filter
            if (currentFilters.onSale) {
                filtered = filtered.filter(product => product.originalPrice && product.originalPrice > product.price);
            }

            // Sort
            filtered = sortProducts(filtered, currentFilters.sort);

            return filtered;
        }

        function sortProducts(products, sortBy) {
            const sorted = [...products];

            switch (sortBy) {
                case 'price-asc':
                    return sorted.sort((a, b) => a.price - b.price);
                case 'price-desc':
                    return sorted.sort((a, b) => b.price - a.price);
                case 'name-asc':
                    return sorted.sort((a, b) => a.name.localeCompare(b.name));
                case 'name-desc':
                    return sorted.sort((a, b) => b.name.localeCompare(a.name));
                case 'rating':
                    return sorted.sort((a, b) => b.rating - a.rating);
                case 'newest':
                    return sorted.sort((a, b) => b.id - a.id);
                default:
                    return sorted;
            }
        }

        function displayProducts(products) {
            const gridContainer = document.getElementById('products-grid');
            const listContainer = document.getElementById('products-list');
            const emptyState = document.getElementById('empty-state');

            if (products.length === 0) {
                gridContainer.classList.add('hidden');
                listContainer.classList.add('hidden');
                emptyState.classList.remove('hidden');
                return;
            }
        }

        function displayProducts(products) {
            const gridContainer = document.getElementById('products-grid');
            const listContainer = document.getElementById('products-list');
            const emptyState = document.getElementById('empty-state');

            if (products.length === 0) {
                gridContainer.classList.add('hidden');
                listContainer.classList.add('hidden');
                emptyState.classList.remove('hidden');
                return;
            }

            emptyState.classList.add('hidden');

            // Pagination
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const paginatedProducts = products.slice(startIndex, endIndex);

            if (currentView === 'grid') {
                gridContainer.classList.remove('hidden');
                listContainer.classList.add('hidden');
                renderGridView(paginatedProducts);
            } else {
                gridContainer.classList.add('hidden');
                listContainer.classList.remove('hidden');
                renderListView(paginatedProducts);
            }
        }

        function renderGridView(products) {
            const container = document.getElementById('products-grid');
            container.innerHTML = products.map(product => `
                <div class="product-card card-hover" onclick="openProduct('${product.slug}')">
                    <div class="relative">
                        <div class="aspect-square bg-gray-100 flex items-center justify-center text-4xl">
                            ${product.image}
                        </div>
                        ${!product.inStock ? '<div class="absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center"><span class="text-white font-semibold">Tugagan</span></div>' : ''}
                        ${product.originalPrice ? '<div class="absolute top-2 left-2 bg-red-500 text-white text-xs px-2 py-1 rounded-full">Chegirma</div>' : ''}
                        ${product.featured ? '<div class="absolute top-2 right-2 bg-primary text-white text-xs px-2 py-1 rounded-full">Top</div>' : ''}
                    </div>
                    <div class="product-info">
                        <h3 class="product-title">${product.name}</h3>
                        <p class="product-category">${product.categoryName}</p>
                        <div class="flex items-center mb-2">
                            <div class="flex items-center">
                                <span class="text-yellow-400 text-sm">â˜…</span>
                                <span class="text-xs text-gray-600 ml-1">${product.rating} (${product.reviews})</span>
                            </div>
                        </div>
                        <div class="flex items-center justify-between">
                            <div>
                                <div class="flex items-center space-x-2">
                                    <span class="product-price">${product.price.toLocaleString()}</span>
                                    ${product.originalPrice ? `<span class="text-xs text-gray-500 line-through">${product.originalPrice.toLocaleString()}</span>` : ''}
                                </div>
                                <span class="text-xs text-gray-500">so'm/${product.unit}</span>
                            </div>
                            <button onclick="addToCart(event, ${product.id})"
                                    class="bg-primary text-white p-2 rounded-lg hover:bg-primary-dark transition-colors ${!product.inStock ? 'opacity-50 cursor-not-allowed' : ''}"
                                    ${!product.inStock ? 'disabled' : ''}>
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function renderListView(products) {
            const container = document.getElementById('products-list');
            container.innerHTML = products.map(product => `
                <div class="bg-white rounded-2xl p-4 card-hover" onclick="openProduct('${product.slug}')">
                    <div class="flex items-center space-x-4">
                        <div class="relative w-24 h-24 flex-shrink-0">
                            <div class="w-full h-full bg-gray-100 rounded-lg flex items-center justify-center text-3xl">
                                ${product.image}
                            </div>
                            ${!product.inStock ? '<div class="absolute inset-0 bg-black bg-opacity-50 rounded-lg flex items-center justify-center"><span class="text-white text-xs font-semibold">Tugagan</span></div>' : ''}
                        </div>
                        <div class="flex-1 min-w-0">
                            <div class="flex items-start justify-between">
                                <div class="flex-1">
                                    <h3 class="font-semibold text-gray-800 truncate">${product.name}</h3>
                                    <p class="text-sm text-gray-500">${product.categoryName}</p>
                                    <div class="flex items-center mt-1">
                                        <span class="text-yellow-400 text-sm">â˜…</span>
                                        <span class="text-xs text-gray-600 ml-1">${product.rating} (${product.reviews} ta sharh)</span>
                                    </div>
                                    <div class="flex items-center space-x-2 mt-2">
                                        <span class="text-lg font-bold text-primary">${product.price.toLocaleString()}</span>
                                        ${product.originalPrice ? `<span class="text-sm text-gray-500 line-through">${product.originalPrice.toLocaleString()}</span>` : ''}
                                        <span class="text-sm text-gray-500">so'm/${product.unit}</span>
                                    </div>
                                </div>
                                <button onclick="addToCart(event, ${product.id})"
                                        class="btn btn-primary btn-sm ${!product.inStock ? 'opacity-50 cursor-not-allowed' : ''}"
                                        ${!product.inStock ? 'disabled' : ''}>
                                    ${product.inStock ? 'Savatga' : 'Tugagan'}
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function showLoading(show) {
            const loading = document.getElementById('loading');
            const productsGrid = document.getElementById('products-grid');
            const productsList = document.getElementById('products-list');

            if (show) {
                loading.classList.remove('hidden');
                productsGrid.classList.add('hidden');
                productsList.classList.add('hidden');
            } else {
                loading.classList.add('hidden');
            }
        }

        function updateProductsCount(count) {
            document.getElementById('products-count').textContent = `${count} ta mahsulot`;
        }

        function updatePagination(totalItems) {
            const pagination = document.getElementById('pagination');
            const totalPages = Math.ceil(totalItems / itemsPerPage);

            if (totalPages <= 1) {
                pagination.classList.add('hidden');
                return;
            }

            pagination.classList.remove('hidden');

            const pageNumbers = document.getElementById('page-numbers');
            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');

            // Update buttons
            prevBtn.disabled = currentPage === 1;
            nextBtn.disabled = currentPage === totalPages;

            // Generate page numbers
            let pages = [];
            if (totalPages <= 7) {
                for (let i = 1; i <= totalPages; i++) {
                    pages.push(i);
                }
            } else {
                if (currentPage <= 4) {
                    pages = [1, 2, 3, 4, 5, '...', totalPages];
                } else if (currentPage >= totalPages - 3) {
                    pages = [1, '...', totalPages - 4, totalPages - 3, totalPages - 2, totalPages - 1, totalPages];
                } else {
                    pages = [1, '...', currentPage - 1, currentPage, currentPage + 1, '...', totalPages];
                }
            }

            pageNumbers.innerHTML = pages.map(page => {
                if (page === '...') {
                    return '<span class="px-3 py-2">...</span>';
                }
                const isActive = page === currentPage;
                return `
                    <button onclick="goToPage(${page})"
                            class="px-3 py-2 border border-gray-300 rounded ${isActive ? 'bg-primary text-white border-primary' : 'hover:bg-gray-50'}">
                        ${page}
                    </button>
                `;
            }).join('');
        }

        function goToPage(page) {
            currentPage = page;
            loadProducts();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function previousPage() {
            if (currentPage > 1) {
                goToPage(currentPage - 1);
            }
        }

        function nextPage() {
            const totalPages = Math.ceil(getFilteredProducts().length / itemsPerPage);
            if (currentPage < totalPages) {
                goToPage(currentPage + 1);
            }
        }

        function setView(view) {
            currentView = view;

            const gridBtn = document.getElementById('grid-view');
            const listBtn = document.getElementById('list-view');

            if (view === 'grid') {
                gridBtn.classList.add('bg-primary', 'text-white');
                gridBtn.classList.remove('bg-gray-200', 'text-gray-600');
                listBtn.classList.add('bg-gray-200', 'text-gray-600');
                listBtn.classList.remove('bg-primary', 'text-white');
            } else {
                listBtn.classList.add('bg-primary', 'text-white');
                listBtn.classList.remove('bg-gray-200', 'text-gray-600');
                gridBtn.classList.add('bg-gray-200', 'text-gray-600');
                gridBtn.classList.remove('bg-primary', 'text-white');
            }

            displayProducts(getFilteredProducts());
        }

        function handleSort() {
            currentFilters.sort = document.getElementById('sort-select').value;
            currentPage = 1;
            loadProducts();
        }

        function toggleFilters() {
            const sidebar = document.getElementById('filters-sidebar');
            const overlay = document.getElementById('filter-overlay');
            const isOpen = !sidebar.classList.contains('translate-x-full');

            if (isOpen) {
                sidebar.classList.add('translate-x-full');
                overlay.classList.add('hidden');
            } else {
                sidebar.classList.remove('translate-x-full');
                overlay.classList.remove('hidden');
            }
        }

        function toggleSearch() {
            const searchContainer = document.getElementById('mobile-search');
            searchContainer.classList.toggle('hidden');

            if (!searchContainer.classList.contains('hidden')) {
                document.getElementById('mobile-search-input').focus();
            }
        }

        function handleMobileSearch() {
            const query = document.getElementById('mobile-search-input').value;
            currentFilters.search = query;
            currentPage = 1;
            loadProducts();
        }

        function setPriceRange(min, max) {
            document.getElementById('min-price').value = min;
            document.getElementById('max-price').value = max;
        }

        function applyFilters() {
            // Price filters
            const minPrice = document.getElementById('min-price').value;
            const maxPrice = document.getElementById('max-price').value;
            currentFilters.minPrice = minPrice ? parseInt(minPrice) : null;
            currentFilters.maxPrice = maxPrice ? parseInt(maxPrice) : null;

            // Category filters
            const categoryCheckboxes = document.querySelectorAll('.category-filter:checked');
            if (categoryCheckboxes.length > 0) {
                currentFilters.category = categoryCheckboxes[0].value;
            }

            // Brand filters
            const brandCheckboxes = document.querySelectorAll('.brand-filter:checked');
            currentFilters.brands = Array.from(brandCheckboxes).map(cb => cb.value);

            // Rating filter
            const ratingRadio = document.querySelector('input[name="rating"]:checked');
            currentFilters.rating = ratingRadio ? ratingRadio.value : null;

            // Other filters
            currentFilters.inStock = document.getElementById('in-stock').checked;
            currentFilters.onSale = document.getElementById('on-sale').checked;

            currentPage = 1;
            loadProducts();
            toggleFilters();
        }

        function clearFilters() {
            // Reset form inputs
            document.getElementById('min-price').value = '';
            document.getElementById('max-price').value = '';
            document.querySelectorAll('.category-filter').forEach(cb => cb.checked = false);
            document.querySelectorAll('.brand-filter').forEach(cb => cb.checked = false);
            document.querySelectorAll('input[name="rating"]').forEach(rb => rb.checked = false);
            document.getElementById('in-stock').checked = false;
            document.getElementById('on-sale').checked = false;
            document.getElementById('sort-select').value = 'default';

            // Reset filters (keep category from URL)
            const urlParams = new URLSearchParams(window.location.search);
            const category = urlParams.get('category');

            currentFilters = {
                category: category,
                search: '',
                minPrice: null,
                maxPrice: null,
                sort: 'default',
                brands: [],
                rating: null,
                inStock: false,
                onSale: false
            };

            currentPage = 1;
            loadProducts();
        }

        function openProduct(slug) {
            window.location.href = `product-detail.html?product=${slug}`;
        }

        function addToCart(event, productId) {
            event.stopPropagation();

            const product = productsData.find(p => p.id === productId);
            if (!product || !product.inStock) {
                return;
            }

            let cart = JSON.parse(localStorage.getItem('cart') || '[]');
            const existingItem = cart.find(item => item.id === productId);

            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                cart.push({...product, quantity: 1});
            }

            localStorage.setItem('cart', JSON.stringify(cart));
            updateCartCount();
            showNotification(`${product.name} savatga qo'shildi!`, 'success');
        }

        function updateCartCount() {
            const cart = JSON.parse(localStorage.getItem('cart') || '[]');
            const count = cart.reduce((total, item) => total + item.quantity, 0);

            document.querySelectorAll('[id="cart-count"], .bg-accent').forEach(element => {
                element.textContent = count;
            });
        }

        function goBack() {
            if (document.referrer) {
                history.back();
            } else {
                window.location.href = 'index.html';
            }
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;

            document.body.appendChild(notification);

            setTimeout(() => {
                notification.classList.add('show');
            }, 100);

            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    if (notification.parentNode) {
                        document.body.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }

        // Search on Enter key
        document.getElementById('mobile-search-input')?.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                handleMobileSearch();
            }
        });
    </script>
</body>
</html>
