<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DOM PRODUCT - Qidiruv</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#10b981',
                        'primary-dark': '#059669',
                        secondary: '#1f2937',
                        accent: '#f59e0b'
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-50">
    <!-- Navigation Header -->
    <header class="gradient-bg text-white sticky top-0 z-50 shadow-lg">
        <div class="container mx-auto px-4">
            <div class="flex items-center justify-between h-16">
                <!-- Back Button & Search -->
                <div class="flex items-center space-x-3 flex-1">
                    <button onclick="goBack()" class="p-2 hover:bg-white/20 rounded-lg transition-colors">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                        </svg>
                    </button>

                    <!-- Search Input -->
                    <div class="relative flex-1 max-w-2xl">
                        <input type="text"
                               id="search-input"
                               placeholder="Mahsulot, kategoriya yoki brend qidiring..."
                               class="w-full px-4 py-2 pl-12 pr-12 rounded-lg bg-white/20 text-white placeholder-green-200 border border-white/30 focus:border-primary focus:outline-none"
                               autocomplete="off">
                        <svg class="w-5 h-5 text-green-200 absolute left-3 top-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m21 21-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                        </svg>
                        <button onclick="clearSearch()" id="clear-btn" class="absolute right-3 top-3 text-green-200 hover:text-white hidden">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                            </svg>
                        </button>
                    </div>
                </div>

                <!-- Cart -->
                <div class="flex items-center space-x-4">
                    <a href="cart.html" class="relative p-2 hover:bg-white/20 rounded-lg transition-colors">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4m0 0L7 13m0 0l-1.5 6M7 13l-1.5 6m0 0h9"></path>
                        </svg>
                        <span class="absolute -top-1 -right-1 bg-accent text-xs text-white rounded-full w-5 h-5 flex items-center justify-center" id="cart-count">0</span>
                    </a>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-6">
        <!-- Search Suggestions (when typing) -->
        <div id="search-suggestions" class="bg-white rounded-2xl shadow-sm border mb-6 hidden">
            <div class="p-4">
                <h3 class="font-semibold text-gray-800 mb-3">Tavsiyalar</h3>
                <div id="suggestions-list" class="space-y-2">
                    <!-- Suggestions will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Search Filters -->
        <div id="search-filters" class="bg-white rounded-2xl shadow-sm mb-6 hidden">
            <div class="p-4">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="font-semibold text-gray-800">Filtrlar</h3>
                    <button onclick="clearAllFilters()" class="text-sm text-primary hover:text-primary-dark">
                        Barchasini tozalash
                    </button>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <!-- Category Filter -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Kategoriya</label>
                        <select id="category-filter" class="form-input text-sm" onchange="applyFilters()">
                            <option value="">Barcha kategoriyalar</option>
                            <option value="fruits">Mevalar</option>
                            <option value="vegetables">Sabzavotlar</option>
                            <option value="meat">Go'sht mahsulotlari</option>
                            <option value="dairy">Sut mahsulotlari</option>
                            <option value="bakery">Non va g'alla</option>
                            <option value="drinks">Ichimliklar</option>
                        </select>
                    </div>

                    <!-- Price Range -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Narx oralig'i</label>
                        <select id="price-filter" class="form-input text-sm" onchange="applyFilters()">
                            <option value="">Barcha narxlar</option>
                            <option value="0-10000">0 - 10,000 so'm</option>
                            <option value="10000-25000">10,000 - 25,000 so'm</option>
                            <option value="25000-50000">25,000 - 50,000 so'm</option>
                            <option value="50000-100000">50,000 - 100,000 so'm</option>
                            <option value="100000+">100,000+ so'm</option>
                        </select>
                    </div>

                    <!-- Sort By -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Saralash</label>
                        <select id="sort-filter" class="form-input text-sm" onchange="applyFilters()">
                            <option value="relevance">Mos kelishi bo'yicha</option>
                            <option value="price-asc">Narx: Arzondan qimmatge</option>
                            <option value="price-desc">Narx: Qimmatdan arzonga</option>
                            <option value="name-asc">Nomi: A-Z</option>
                            <option value="rating">Reyting bo'yicha</option>
                            <option value="newest">Yangi mahsulotlar</option>
                        </select>
                    </div>

                    <!-- Availability -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Mavjudlik</label>
                        <select id="availability-filter" class="form-input text-sm" onchange="applyFilters()">
                            <option value="">Barchasi</option>
                            <option value="in-stock">Faqat mavjud</option>
                            <option value="on-sale">Chegirmadagi</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <!-- Search Results Header -->
        <div id="search-results-header" class="flex items-center justify-between mb-6 hidden">
            <div>
                <h2 class="text-xl font-bold text-gray-800" id="results-title">Qidiruv natijalari</h2>
                <p class="text-gray-600" id="results-count">0 ta mahsulot topildi</p>
            </div>
            <div class="flex items-center space-x-2">
                <button onclick="toggleView('grid')" id="grid-view-btn" class="p-2 rounded-lg bg-primary text-white">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M3 3h8v8H3V3zm10 0h8v8h-8V3zM3 13h8v8H3v-8zm10 0h8v8h-8v-8z"/>
                    </svg>
                </button>
                <button onclick="toggleView('list')" id="list-view-btn" class="p-2 rounded-lg bg-gray-200 text-gray-600">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M3 4h18v2H3V4zm0 7h18v2H3v-2zm0 7h18v2H3v-2z"/>
                    </svg>
                </button>
            </div>
        </div>

        <!-- Initial State -->
        <div id="initial-state">
            <!-- Recent Searches -->
            <div class="bg-white rounded-2xl shadow-sm mb-6">
                <div class="p-4">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="font-semibold text-gray-800">So'nggi qidiruvlar</h3>
                        <button onclick="clearRecentSearches()" class="text-sm text-primary hover:text-primary-dark">
                            Tozalash
                        </button>
                    </div>
                    <div id="recent-searches" class="flex flex-wrap gap-2">
                        <!-- Recent searches will be loaded here -->
                    </div>
                </div>
            </div>

            <!-- Popular Searches -->
            <div class="bg-white rounded-2xl shadow-sm mb-6">
                <div class="p-4">
                    <h3 class="font-semibold text-gray-800 mb-4">Mashhur qidiruvlar</h3>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                        <button onclick="searchFor('olma')" class="p-3 bg-gray-50 rounded-lg text-left hover:bg-gray-100 transition-colors">
                            <div class="text-2xl mb-2">🍎</div>
                            <div class="font-medium text-gray-800">Olma</div>
                            <div class="text-xs text-gray-500">124 mahsulot</div>
                        </button>

                        <button onclick="searchFor('pomidor')" class="p-3 bg-gray-50 rounded-lg text-left hover:bg-gray-100 transition-colors">
                            <div class="text-2xl mb-2">🍅</div>
                            <div class="font-medium text-gray-800">Pomidor</div>
                            <div class="text-xs text-gray-500">86 mahsulot</div>
                        </button>

                        <button onclick="searchFor('non')" class="p-3 bg-gray-50 rounded-lg text-left hover:bg-gray-100 transition-colors">
                            <div class="text-2xl mb-2">🍞</div>
                            <div class="font-medium text-gray-800">Non</div>
                            <div class="text-xs text-gray-500">43 mahsulot</div>
                        </button>

                        <button onclick="searchFor('sut')" class="p-3 bg-gray-50 rounded-lg text-left hover:bg-gray-100 transition-colors">
                            <div class="text-2xl mb-2">🥛</div>
                            <div class="font-medium text-gray-800">Sut</div>
                            <div class="text-xs text-gray-500">32 mahsulot</div>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Categories Quick Access -->
            <div class="bg-white rounded-2xl shadow-sm">
                <div class="p-4">
                    <h3 class="font-semibold text-gray-800 mb-4">Kategoriyalar bo'yicha qidirish</h3>
                    <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                        <a href="products.html?category=fruits" class="flex items-center space-x-3 p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors">
                            <div class="text-2xl">🍎</div>
                            <div>
                                <div class="font-medium text-gray-800">Mevalar</div>
                                <div class="text-xs text-gray-500">120+ mahsulot</div>
                            </div>
                        </a>

                        <a href="products.html?category=vegetables" class="flex items-center space-x-3 p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors">
                            <div class="text-2xl">🥬</div>
                            <div>
                                <div class="font-medium text-gray-800">Sabzavotlar</div>
                                <div class="text-xs text-gray-500">85+ mahsulot</div>
                            </div>
                        </a>

                        <a href="products.html?category=meat" class="flex items-center space-x-3 p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors">
                            <div class="text-2xl">🥩</div>
                            <div>
                                <div class="font-medium text-gray-800">Go'sht</div>
                                <div class="text-xs text-gray-500">45+ mahsulot</div>
                            </div>
                        </a>

                        <a href="products.html?category=dairy" class="flex items-center space-x-3 p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors">
                            <div class="text-2xl">🥛</div>
                            <div>
                                <div class="font-medium text-gray-800">Sut mahsulotlari</div>
                                <div class="text-xs text-gray-500">32+ mahsulot</div>
                            </div>
                        </a>

                        <a href="products.html?category=bakery" class="flex items-center space-x-3 p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors">
                            <div class="text-2xl">🍞</div>
                            <div>
                                <div class="font-medium text-gray-800">Non va g'alla</div>
                                <div class="text-xs text-gray-500">28+ mahsulot</div>
                            </div>
                        </a>

                        <a href="products.html?category=drinks" class="flex items-center space-x-3 p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors">
                            <div class="text-2xl">🥤</div>
                            <div>
                                <div class="font-medium text-gray-800">Ichimliklar</div>
                                <div class="text-xs text-gray-500">64+ mahsulot</div>
                            </div>
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Search Results -->
        <div id="search-results" class="hidden">
            <!-- Loading State -->
            <div id="search-loading" class="text-center py-12 hidden">
                <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary"></div>
                <p class="mt-2 text-gray-600">Qidirilmoqda...</p>
            </div>

            <!-- Results Grid -->
            <div id="results-grid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4 hidden">
                <!-- Search results will be loaded here -->
            </div>

            <!-- Results List -->
            <div id="results-list" class="space-y-4 hidden">
                <!-- Search results will be loaded here -->
            </div>

            <!-- No Results -->
            <div id="no-results" class="text-center py-12 hidden">
                <svg class="w-16 h-16 mx-auto mb-4 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                </svg>
                <h3 class="text-lg font-semibold text-gray-700 mb-2">Hech narsa topilmadi</h3>
                <p class="text-gray-500 mb-6">
                    "<span id="search-query-display"></span>" uchun natija yo'q
                </p>
                <div class="space-y-3 max-w-sm mx-auto">
                    <p class="text-sm text-gray-600">Tavsiyalar:</p>
                    <ul class="text-sm text-gray-500 space-y-1">
                        <li>• Imloni tekshiring</li>
                        <li>• Qisqaroq so'zlardan foydalaning</li>
                        <li>• Umumiy so'zlarni sinab ko'ring</li>
                        <li>• Kategoriyalar orqali qidiring</li>
                    </ul>
                    <button onclick="clearSearch()" class="btn btn-primary">
                        Qayta qidirish
                    </button>
                </div>
            </div>
        </div>
    </main>

    <!-- Bottom Navigation (Mobile) -->
    <nav class="md:hidden fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 z-50">
        <div class="flex items-center justify-around py-2">
            <a href="index.html" class="flex flex-col items-center py-2 px-3 text-gray-500">
                <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
                </svg>
                <span class="text-xs mt-1">Bosh sahifa</span>
            </a>
            <a href="categories.html" class="flex flex-col items-center py-2 px-3 text-gray-500">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 10h16M4 14h16M4 18h16"/>
                </svg>
                <span class="text-xs mt-1">Kategoriya</span>
            </a>
            <a href="cart.html" class="flex flex-col items-center py-2 px-3 text-gray-500">
                <div class="relative">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4m0 0L7 13m0 0l-1.5 6M7 13l-1.5 6m0 0h9"/>
                    </svg>
                    <span class="absolute -top-2 -right-2 bg-accent text-xs text-white rounded-full w-4 h-4 flex items-center justify-center">0</span>
                </div>
                <span class="text-xs mt-1">Savat</span>
            </a>
            <a href="search.html" class="flex flex-col items-center py-2 px-3 text-primary">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m21 21-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                </svg>
                <span class="text-xs mt-1">Qidiruv</span>
            </a>
            <a href="profile.html" class="flex flex-col items-center py-2 px-3 text-gray-500">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                </svg>
                <span class="text-xs mt-1">Profil</span>
            </a>
        </div>
    </nav>

    <script>
        // Demo products data for search
        const searchData = [
            { id: 1, name: "Toza olma", price: 8000, originalPrice: 10000, image: "🍎", category: "fruits", categoryName: "Mevalar", unit: "kg", rating: 4.5, reviews: 24, inStock: true, brand: "Mahalliy" },
            { id: 2, name: "Yangi pomidor", price: 12000, image: "🍅", category: "vegetables", categoryName: "Sabzavotlar", unit: "kg", rating: 4.8, reviews: 18, inStock: true, brand: "Import" },
            { id: 3, name: "Premium mol go'shti", price: 85000, image: "🥩", category: "meat", categoryName: "Go'sht", unit: "kg", rating: 4.9, reviews: 12, inStock: true, brand: "Mahalliy" },
            { id: 4, name: "Toza sut", price: 8500, image: "🥛", category: "dairy", categoryName: "Sut mahsulotlari", unit: "litr", rating: 4.6, reviews: 31, inStock: true, brand: "Mahalliy" },
            { id: 5, name: "Issiq non", price: 3500, image: "🍞", category: "bakery", categoryName: "Non", unit: "dona", rating: 4.3, reviews: 45, inStock: true, brand: "Mahalliy" },
            { id: 6, name: "Shirin banan", price: 18000, originalPrice: 20000, image: "🍌", category: "fruits", categoryName: "Mevalar", unit: "kg", rating: 4.7, reviews: 19, inStock: true, brand: "Import" },
            { id: 7, name: "Organik sabzi", price: 15000, image: "🥕", category: "vegetables", categoryName: "Sabzavotlar", unit: "kg", rating: 4.4, reviews: 13, inStock: false, brand: "Organik" },
            { id: 8, name: "Baliq filesi", price: 45000, image: "🐟", category: "fish", categoryName: "Baliq", unit: "kg", rating: 4.2, reviews: 8, inStock: true, brand: "Import" },
            { id: 9, name: "Toza apelsin", price: 16000, image: "🍊", category: "fruits", categoryName: "Mevalar", unit: "kg", rating: 4.6, reviews: 22, inStock: true, brand: "Import" },
            { id: 10, name: "Kartoshka", price: 4000, image: "🥔", category: "vegetables", categoryName: "Sabzavotlar", unit: "kg", rating: 4.1, reviews: 35, inStock: true, brand: "Mahalliy" }
        ];

        let currentSearchQuery = '';
        let currentView = 'grid';
        let searchFilters = {
            category: '',
            priceRange: '',
            sort: 'relevance',
            availability: ''
        };
        let searchResults = [];
        let recentSearches = JSON.parse(localStorage.getItem('recentSearches') || '[]');

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            setupSearchInput();
            loadRecentSearches();
            updateCartCount();

            // Check for query parameter
            const urlParams = new URLSearchParams(window.location.search);
            const query = urlParams.get('q');
            if (query) {
                document.getElementById('search-input').value = query;
                performSearch(query);
            }
        });

        function setupSearchInput() {
            const searchInput = document.getElementById('search-input');
            const clearBtn = document.getElementById('clear-btn');
            let searchTimeout;

            searchInput.addEventListener('input', function() {
                const query = this.value.trim();

                if (query.length > 0) {
                    clearBtn.classList.remove('hidden');

                    // Show suggestions after 300ms delay
                    clearTimeout(searchTimeout);
                    searchTimeout = setTimeout(() => {
                        showSearchSuggestions(query);
                    }, 300);
                } else {
                    clearBtn.classList.add('hidden');
                    hideSearchSuggestions();
                    showInitialState();
                }
            });

            searchInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    const query = this.value.trim();
                    if (query) {
                        performSearch(query);
                    }
                }
            });

            // Focus on search input
            searchInput.focus();
        }

        function showSearchSuggestions(query) {
            if (query.length < 2) return;

            const suggestions = generateSuggestions(query);
            const suggestionsContainer = document.getElementById('suggestions-list');
            const suggestionsBox = document.getElementById('search-suggestions');

            if (suggestions.length > 0) {
                suggestionsContainer.innerHTML = suggestions.map(suggestion => `
                    <button onclick="selectSuggestion('${suggestion.text}')"
                            class="w-full flex items-center space-x-3 p-2 hover:bg-gray-50 rounded-lg text-left">
                        <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m21 21-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                        </svg>
                        <div>
                            <div class="font-medium text-gray-800">${suggestion.text}</div>
                            ${suggestion.category ? `<div class="text-xs text-gray-500">${suggestion.category}</div>` : ''}
                        </div>
                    </button>
                `).join('');

                suggestionsBox.classList.remove('hidden');
            } else {
                hideSearchSuggestions();
            }
        }

        function generateSuggestions(query) {
            const suggestions = [];
            const queryLower = query.toLowerCase();

            // Product suggestions
            searchData.forEach(product => {
                if (product.name.toLowerCase().includes(queryLower)) {
                    suggestions.push({
                        text: product.name,
                        category: product.categoryName,
                        type: 'product'
                    });
                }
            });

            // Category suggestions
            const categories = ['Mevalar', 'Sabzavotlar', 'Go\'sht mahsulotlari', 'Sut mahsulotlari', 'Non va g\'alla', 'Ichimliklar'];
            categories.forEach(category => {
                if (category.toLowerCase().includes(queryLower)) {
                    suggestions.push({
                        text: category,
                        type: 'category'
                    });
                }
            });

            // Brand suggestions
            const brands = ['Mahalliy', 'Import', 'Organik'];
            brands.forEach(brand => {
                if (brand.toLowerCase().includes(queryLower)) {
                    suggestions.push({
                        text: brand,
                        category: 'Brend',
                        type: 'brand'
                    });
                }
            });

            return suggestions.slice(0, 8); // Limit to 8 suggestions
        }

        function selectSuggestion(suggestion) {
            document.getElementById('search-input').value = suggestion;
            performSearch(suggestion);
        }

        function hideSearchSuggestions() {
            document.getElementById('search-suggestions').classList.add('hidden');
        }

        function performSearch(query) {
            currentSearchQuery = query.trim();

            if (!currentSearchQuery) {
                showInitialState();
                return;
            }

            // Hide suggestions and initial state
            hideSearchSuggestions();
            hideInitialState();

            // Show search results section
            document.getElementById('search-results').classList.remove('hidden');
            document.getElementById('search-filters').classList.remove('hidden');
            document.getElementById('search-results-header').classList.remove('hidden');

            // Show loading
            showSearchLoading(true);

            // Add to recent searches
            addToRecentSearches(currentSearchQuery);

            // Perform the search
            setTimeout(() => {
                const results = getSearchResults(currentSearchQuery);
                displaySearchResults(results);
                showSearchLoading(false);
            }, 800);

            // Update URL
            const newUrl = new URL(window.location);
            newUrl.searchParams.set('q', currentSearchQuery);
            window.history.pushState({}, '', newUrl);
        }

        function getSearchResults(query) {
            let results = [...searchData];
            const queryLower = query.toLowerCase();

            // Text search
            results = results.filter(product =>
                product.name.toLowerCase().includes(queryLower) ||
                product.categoryName.toLowerCase().includes(queryLower) ||
                product.brand.toLowerCase().includes(queryLower)
            );

            // Apply filters
            if (searchFilters.category) {
                results = results.filter(product => product.category === searchFilters.category);
            }

            if (searchFilters.priceRange) {
                results = filterByPriceRange(results, searchFilters.priceRange);
            }

            if (searchFilters.availability === 'in-stock') {
                results = results.filter(product => product.inStock);
            } else if (searchFilters.availability === 'on-sale') {
                results = results.filter(product => product.originalPrice && product.originalPrice > product.price);
            }

            // Sort results
            results = sortSearchResults(results, searchFilters.sort, query);

            return results;
        }

        function filterByPriceRange(products, range) {
            switch (range) {
                case '0-10000':
                    return products.filter(p => p.price <= 10000);
                case '10000-25000':
                    return products.filter(p => p.price > 10000 && p.price <= 25000);
                case '25000-50000':
                    return products.filter(p => p.price > 25000 && p.price <= 50000);
                case '50000-100000':
                    return products.filter(p => p.price > 50000 && p.price <= 100000);
                case '100000+':
                    return products.filter(p => p.price > 100000);
                default:
                    return products;
            }
        }

        function sortSearchResults(products, sortBy, query) {
            const sorted = [...products];

            switch (sortBy) {
                case 'relevance':
                    // Sort by relevance (exact matches first, then partial matches)
                    return sorted.sort((a, b) => {
                        const aExact = a.name.toLowerCase() === query.toLowerCase() ? 1 : 0;
                        const bExact = b.name.toLowerCase() === query.toLowerCase() ? 1 : 0;
                        if (aExact !== bExact) return bExact - aExact;

                        const aStarts = a.name.toLowerCase().startsWith(query.toLowerCase()) ? 1 : 0;
                        const bStarts = b.name.toLowerCase().startsWith(query.toLowerCase()) ? 1 : 0;
                        if (aStarts !== bStarts) return bStarts - aStarts;

                        return b.rating - a.rating;
                    });
                case 'price-asc':
                    return sorted.sort((a, b) => a.price - b.price);
                case 'price-desc':
                    return sorted.sort((a, b) => b.price - a.price);
                case 'name-asc':
                    return sorted.sort((a, b) => a.name.localeCompare(b.name));
                case 'rating':
                    return sorted.sort((a, b) => b.rating - a.rating);
                case 'newest':
                    return sorted.sort((a, b) => b.id - a.id);
                default:
                    return sorted;
            }
        }

        function displaySearchResults(results) {
            searchResults = results;

            // Update results header
            document.getElementById('results-title').textContent = `"${currentSearchQuery}" uchun natijalar`;
            document.getElementById('results-count').textContent = `${results.length} ta mahsulot topildi`;

            if (results.length === 0) {
                showNoResults();
                return;
            }

            hideNoResults();

            if (currentView === 'grid') {
                displayGridResults(results);
            } else {
                displayListResults(results);
            }
        }

        function displayGridResults(results) {
            const gridContainer = document.getElementById('results-grid');
            const listContainer = document.getElementById('results-list');

            listContainer.classList.add('hidden');
            gridContainer.classList.remove('hidden');

            gridContainer.innerHTML = results.map(product => `
                <div class="product-card card-hover" onclick="openProduct('${product.id}')">
                    <div class="relative">
                        <div class="aspect-square bg-gray-100 flex items-center justify-center text-4xl">
                            ${product.image}
                        </div>
                        ${!product.inStock ? '<div class="absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center"><span class="text-white font-semibold text-sm">Tugagan</span></div>' : ''}
                        ${product.originalPrice ? '<div class="absolute top-2 left-2 bg-red-500 text-white text-xs px-2 py-1 rounded-full">Chegirma</div>' : ''}
                    </div>
                    <div class="product-info">
                        <h3 class="product-title">${highlightSearchTerm(product.name, currentSearchQuery)}</h3>
                        <p class="product-category">${product.categoryName}</p>
                        <div class="flex items-center mb-2">
                            <span class="text-yellow-400 text-sm">★</span>
                            <span class="text-xs text-gray-600 ml-1">${product.rating} (${product.reviews})</span>
                        </div>
                        <div class="flex items-center justify-between">
                            <div>
                                <div class="flex items-center space-x-2">
                                    <span class="product-price">${product.price.toLocaleString()}</span>
                                    ${product.originalPrice ? `<span class="text-xs text-gray-500 line-through">${product.originalPrice.toLocaleString()}</span>` : ''}
                                </div>
                                <span class="text-xs text-gray-500">so'm/${product.unit}</span>
                            </div>
                            <button onclick="addToCart(event, ${product.id})"
                                    class="bg-primary text-white p-2 rounded-lg hover:bg-primary-dark transition-colors ${!product.inStock ? 'opacity-50 cursor-not-allowed' : ''}"
                                    ${!product.inStock ? 'disabled' : ''}>
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function displayListResults(results) {
            const gridContainer = document.getElementById('results-grid');
            const listContainer = document.getElementById('results-list');

            gridContainer.classList.add('hidden');
            listContainer.classList.remove('hidden');

            listContainer.innerHTML = results.map(product => `
                <div class="bg-white rounded-2xl p-4 card-hover" onclick="openProduct('${product.id}')">
                    <div class="flex items-center space-x-4">
                        <div class="relative w-24 h-24 flex-shrink-0">
                            <div class="w-full h-full bg-gray-100 rounded-lg flex items-center justify-center text-3xl">
                                ${product.image}
                            </div>
                            ${!product.inStock ? '<div class="absolute inset-0 bg-black bg-opacity-50 rounded-lg flex items-center justify-center"><span class="text-white text-xs font-semibold">Tugagan</span></div>' : ''}
                        </div>
                        <div class="flex-1 min-w-0">
                            <div class="flex items-start justify-between">
                                <div class="flex-1">
                                    <h3 class="font-semibold text-gray-800">${highlightSearchTerm(product.name, currentSearchQuery)}</h3>
                                    <p class="text-sm text-gray-500">${product.categoryName} • ${product.brand}</p>
                                    <div class="flex items-center mt-1">
                                        <span class="text-yellow-400 text-sm">★</span>
                                        <span class="text-xs text-gray-600 ml-1">${product.rating} (${product.reviews} ta sharh)</span>
                                    </div>
                                    <div class="flex items-center space-x-2 mt-2">
                                        <span class="text-lg font-bold text-primary">${product.price.toLocaleString()}</span>
                                        ${product.originalPrice ? `<span class="text-sm text-gray-500 line-through">${product.originalPrice.toLocaleString()}</span>` : ''}
                                        <span class="text-sm text-gray-500">so'm/${product.unit}</span>
                                    </div>
                                </div>
                                <button onclick="addToCart(event, ${product.id})"
                                        class="btn btn-primary btn-sm ${!product.inStock ? 'opacity-50 cursor-not-allowed' : ''}"
                                        ${!product.inStock ? 'disabled' : ''}>
                                    ${product.inStock ? 'Savatga' : 'Tugagan'}
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function highlightSearchTerm(text, searchTerm) {
            if (!searchTerm) return text;

            const regex = new RegExp(`(${searchTerm})`, 'gi');
            return text.replace(regex, '<mark class="bg-yellow-200 px-1 rounded">$1</mark>');
        }

        function showSearchLoading(show) {
            const loading = document.getElementById('search-loading');
            const gridContainer = document.getElementById('results-grid');
            const listContainer = document.getElementById('results-list');
            const noResults = document.getElementById('no-results');

            if (show) {
                loading.classList.remove('hidden');
                gridContainer.classList.add('hidden');
                listContainer.classList.add('hidden');
                noResults.classList.add('hidden');
            } else {
                loading.classList.add('hidden');
            }
        }

        function showNoResults() {
            document.getElementById('search-query-display').textContent = currentSearchQuery;
            document.getElementById('no-results').classList.remove('hidden');
            document.getElementById('results-grid').classList.add('hidden');
            document.getElementById('results-list').classList.add('hidden');
        }

        function hideNoResults() {
            document.getElementById('no-results').classList.add('hidden');
        }

        function showInitialState() {
            document.getElementById('initial-state').classList.remove('hidden');
            document.getElementById('search-results').classList.add('hidden');
            document.getElementById('search-filters').classList.add('hidden');
            document.getElementById('search-results-header').classList.add('hidden');
        }

        function hideInitialState() {
            document.getElementById('initial-state').classList.add('hidden');
        }

        function toggleView(view) {
            currentView = view;

            const gridBtn = document.getElementById('grid-view-btn');
            const listBtn = document.getElementById('list-view-btn');

            if (view === 'grid') {
                gridBtn.classList.add('bg-primary', 'text-white');
                gridBtn.classList.remove('bg-gray-200', 'text-gray-600');
                listBtn.classList.add('bg-gray-200', 'text-gray-600');
                listBtn.classList.remove('bg-primary', 'text-white');
            } else {
                listBtn.classList.add('bg-primary', 'text-white');
                listBtn.classList.remove('bg-gray-200', 'text-gray-600');
                gridBtn.classList.add('bg-gray-200', 'text-gray-600');
                gridBtn.classList.remove('bg-primary', 'text-white');
            }

            if (searchResults.length > 0) {
                displaySearchResults(searchResults);
            }
        }

        function applyFilters() {
            searchFilters.category = document.getElementById('category-filter').value;
            searchFilters.priceRange = document.getElementById('price-filter').value;
            searchFilters.sort = document.getElementById('sort-filter').value;
            searchFilters.availability = document.getElementById('availability-filter').value;

            if (currentSearchQuery) {
                showSearchLoading(true);
                setTimeout(() => {
                    const results = getSearchResults(currentSearchQuery);
                    displaySearchResults(results);
                    showSearchLoading(false);
                }, 500);
            }
        }

        function clearAllFilters() {
            document.getElementById('category-filter').value = '';
            document.getElementById('price-filter').value = '';
            document.getElementById('sort-filter').value = 'relevance';
            document.getElementById('availability-filter').value = '';

            searchFilters = {
                category: '',
                priceRange: '',
                sort: 'relevance',
                availability: ''
            };

            applyFilters();
        }

        function clearSearch() {
            document.getElementById('search-input').value = '';
            document.getElementById('clear-btn').classList.add('hidden');
            currentSearchQuery = '';
            hideSearchSuggestions();
            showInitialState();

            // Clear URL parameter
            const newUrl = new URL(window.location);
            newUrl.searchParams.delete('q');
            window.history.pushState({}, '', newUrl);
        }

        function searchFor(query) {
            document.getElementById('search-input').value = query;
            performSearch(query);
        }

        function addToRecentSearches(query) {
            // Remove if already exists
            recentSearches = recentSearches.filter(search => search !== query);

            // Add to beginning
            recentSearches.unshift(query);

            // Keep only last 10 searches
            recentSearches = recentSearches.slice(0, 10);

            // Save to localStorage
            localStorage.setItem('recentSearches', JSON.stringify(recentSearches));

            // Update UI
            loadRecentSearches();
        }

        function loadRecentSearches() {
            const container = document.getElementById('recent-searches');

            if (recentSearches.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-sm">Hozircha qidiruv tarixi yo\'q</p>';
                return;
            }

            container.innerHTML = recentSearches.map(search => `
                <button onclick="searchFor('${search}')"
                        class="flex items-center space-x-2 px-3 py-2 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors">
                    <svg class="w-4 h-4 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                    <span class="text-sm">${search}</span>
                </button>
            `).join('');
        }

        function clearRecentSearches() {
            recentSearches = [];
            localStorage.removeItem('recentSearches');
            loadRecentSearches();
            showNotification('Qidiruv tarixi tozalandi', 'info');
        }

        function openProduct(productId) {
            window.location.href = `product-detail.html?product=${productId}`;
        }

        function addToCart(event, productId) {
            event.stopPropagation();

            const product = searchData.find(p => p.id === productId);
            if (!product || !product.inStock) {
                return;
            }

            let cart = JSON.parse(localStorage.getItem('cart') || '[]');
            const existingItem = cart.find(item => item.id === productId);

            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                cart.push({...product, quantity: 1});
            }

            localStorage.setItem('cart', JSON.stringify(cart));
            updateCartCount();
            showNotification(`${product.name} savatga qo'shildi!`, 'success');
        }

        function updateCartCount() {
            const cart = JSON.parse(localStorage.getItem('cart') || '[]');
            const count = cart.reduce((total, item) => total + item.quantity, 0);

            document.querySelectorAll('[id="cart-count"], .bg-accent').forEach(element => {
                element.textContent = count;
            });
        }

        function goBack() {
            if (document.referrer) {
                history.back();
            } else {
                window.location.href = 'index.html';
            }
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;

            document.body.appendChild(notification);

            setTimeout(() => {
                notification.classList.add('show');
            }, 100);

            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    if (notification.parentNode) {
                        document.body.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }

        // Hide suggestions when clicking outside
        document.addEventListener('click', function(e) {
            const searchContainer = e.target.closest('#search-suggestions');
            const searchInput = e.target.closest('#search-input');

            if (!searchContainer && !searchInput) {
                hideSearchSuggestions();
            }
        });
    </script>
</body>
</html>
