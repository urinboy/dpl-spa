<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DOM PRODUCT - Mahsulot tafsilotlari</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#10b981',
                        'primary-dark': '#059669',
                        secondary: '#1f2937',
                        accent: '#f59e0b'
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-50">
    <!-- Navigation Header -->
    <header class="gradient-bg text-white sticky top-0 z-50 shadow-lg">
        <div class="container mx-auto px-4">
            <div class="flex items-center justify-between h-16">
                <!-- Back Button & Title -->
                <div class="flex items-center space-x-3">
                    <button onclick="goBack()" class="p-2 hover:bg-white/20 rounded-lg transition-colors">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                        </svg>
                    </button>
                    <div>
                        <h1 class="text-xl font-bold" id="product-name">Mahsulot</h1>
                        <p class="text-xs text-green-200" id="product-category">Kategoriya</p>
                    </div>
                </div>

                <!-- Actions -->
                <div class="flex items-center space-x-4">
                    <!-- Share -->
                    <button onclick="shareProduct()" class="p-2 hover:bg-white/20 rounded-lg transition-colors">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z"/>
                        </svg>
                    </button>

                    <!-- Favorite -->
                    <button onclick="toggleFavorite()" id="favorite-btn" class="p-2 hover:bg-white/20 rounded-lg transition-colors">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                        </svg>
                    </button>

                    <!-- Cart -->
                    <a href="cart.html" class="relative p-2 hover:bg-white/20 rounded-lg transition-colors">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4m0 0L7 13m0 0l-1.5 6M7 13l-1.5 6m0 0h9"></path>
                        </svg>
                        <span class="absolute -top-1 -right-1 bg-accent text-xs text-white rounded-full w-5 h-5 flex items-center justify-center" id="cart-count">0</span>
                    </a>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-6 pb-32">
        <!-- Loading State -->
        <div id="loading" class="text-center py-12">
            <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary"></div>
            <p class="mt-2 text-gray-600">Yuklanmoqda...</p>
        </div>

        <!-- Product Content -->
        <div id="product-content" class="hidden">
            <!-- Breadcrumb -->
            <nav class="mb-6">
                <ol class="flex items-center space-x-2 text-sm">
                    <li><a href="index.html" class="text-gray-500 hover:text-primary">Bosh sahifa</a></li>
                    <li><span class="text-gray-400">/</span></li>
                    <li><a href="categories.html" class="text-gray-500 hover:text-primary">Kategoriyalar</a></li>
                    <li><span class="text-gray-400">/</span></li>
                    <li><a href="#" id="breadcrumb-category" class="text-gray-500 hover:text-primary">Kategoriya</a></li>
                    <li><span class="text-gray-400">/</span></li>
                    <li><span class="text-gray-700" id="breadcrumb-product">Mahsulot</span></li>
                </ol>
            </nav>

            <!-- Product Main Section -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                <!-- Product Images -->
                <div class="space-y-4">
                    <!-- Main Image -->
                    <div class="aspect-square bg-gray-100 rounded-2xl flex items-center justify-center relative overflow-hidden">
                        <div id="main-image" class="text-8xl">📦</div>
                        <div id="product-badges" class="absolute top-4 left-4 space-y-2">
                            <!-- Badges will be added here -->
                        </div>
                    </div>

                    <!-- Thumbnail Images -->
                    <div class="grid grid-cols-4 gap-2" id="thumbnail-images">
                        <!-- Thumbnails will be loaded here -->
                    </div>
                </div>

                <!-- Product Info -->
                <div class="space-y-6">
                    <!-- Title & Rating -->
                    <div>
                        <h1 class="text-3xl font-bold text-gray-800 mb-2" id="product-title">Mahsulot nomi</h1>
                        <div class="flex items-center space-x-4 mb-4">
                            <div class="flex items-center" id="product-rating">
                                <div class="flex text-yellow-400">★★★★★</div>
                                <span class="ml-2 text-sm text-gray-600">(0 ta sharh)</span>
                            </div>
                            <div class="text-sm text-gray-500" id="product-sku">
                                SKU: #001
                            </div>
                        </div>
                        <div class="flex items-center space-x-2">
                            <span id="stock-status" class="px-3 py-1 bg-green-100 text-green-800 text-sm rounded-full">
                                ✅ Mavjud
                            </span>
                            <span class="text-sm text-gray-500" id="product-brand">Brand</span>
                        </div>
                    </div>

                    <!-- Price -->
                    <div class="border-l-4 border-primary pl-4">
                        <div class="flex items-baseline space-x-3">
                            <span class="text-3xl font-bold text-primary" id="current-price">0 so'm</span>
                            <span class="text-lg text-gray-500 line-through hidden" id="original-price">0 so'm</span>
                            <span class="text-sm text-red-500 font-semibold hidden" id="discount-percent">-0%</span>
                        </div>
                        <p class="text-sm text-gray-600 mt-1">
                            <span id="price-unit">dona</span> uchun narx •
                            <span class="text-green-600">Bepul yetkazib berish 50,000 so'mdan yuqori</span>
                        </p>
                    </div>

                    <!-- Quantity Selector -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Miqdor</label>
                        <div class="flex items-center space-x-4">
                            <div class="flex items-center border border-gray-300 rounded-lg">
                                <button onclick="decreaseQuantity()" class="p-3 hover:bg-gray-50 rounded-l-lg">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4"/>
                                    </svg>
                                </button>
                                <input type="number" id="quantity" value="1" min="1" max="10"
                                       class="w-16 text-center border-0 focus:ring-0" onchange="updateQuantity()">
                                <button onclick="increaseQuantity()" class="p-3 hover:bg-gray-50 rounded-r-lg">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                                    </svg>
                                </button>
                            </div>
                            <div class="text-sm text-gray-600">
                                Jami: <span id="total-price" class="font-semibold text-primary">0 so'm</span>
                            </div>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="space-y-3">
                        <button onclick="addToCart()" id="add-to-cart-btn"
                                class="w-full btn btn-primary py-4 text-lg font-semibold">
                            Savatga qo'shish
                        </button>
                        <button onclick="buyNow()"
                                class="w-full btn btn-outline py-4 text-lg font-semibold">
                            Hoziroq sotib olish
                        </button>
                    </div>

                    <!-- Delivery Info -->
                    <div class="bg-gray-50 rounded-lg p-4">
                        <h3 class="font-semibold mb-3">Yetkazib berish ma'lumotlari</h3>
                        <div class="space-y-2 text-sm">
                            <div class="flex justify-between">
                                <span class="text-gray-600">Standart yetkazib berish:</span>
                                <span>15,000 so'm (2-3 kun)</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Tez yetkazib berish:</span>
                                <span>25,000 so'm (1 kun)</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Bepul yetkazib berish:</span>
                                <span class="text-green-600">50,000 so'mdan yuqori</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Product Details Tabs -->
            <div class="bg-white rounded-2xl shadow-sm">
                <!-- Tab Headers -->
                <div class="border-b border-gray-200">
                    <nav class="flex space-x-8 px-6" aria-label="Tabs">
                        <button onclick="switchTab('description')"
                                class="tab-button active py-4 px-1 border-b-2 border-primary text-primary font-medium text-sm">
                            Tavsif
                        </button>
                        <button onclick="switchTab('specifications')"
                                class="tab-button py-4 px-1 border-b-2 border-transparent text-gray-500 font-medium text-sm">
                            Xususiyatlar
                        </button>
                        <button onclick="switchTab('reviews')"
                                class="tab-button py-4 px-1 border-b-2 border-transparent text-gray-500 font-medium text-sm">
                            Sharhlar <span id="reviews-count">(0)</span>
                        </button>
                        <button onclick="switchTab('delivery')"
                                class="tab-button py-4 px-1 border-b-2 border-transparent text-gray-500 font-medium text-sm">
                            Yetkazib berish
                        </button>
                    </nav>
                </div>

                <!-- Tab Contents -->
                <div class="p-6">
                    <!-- Description Tab -->
                    <div id="description-tab" class="tab-content">
                        <div class="prose max-w-none" id="product-description">
                            <p>Mahsulot tavsifi yuklanmoqda...</p>
                        </div>
                    </div>

                    <!-- Specifications Tab -->
                    <div id="specifications-tab" class="tab-content hidden">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6" id="product-specifications">
                            <!-- Specifications will be loaded here -->
                        </div>
                    </div>

                    <!-- Reviews Tab -->
                    <div id="reviews-tab" class="tab-content hidden">
                        <div class="space-y-6">
                            <!-- Reviews Summary -->
                            <div class="bg-gray-50 rounded-lg p-6">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div class="text-center">
                                        <div class="text-4xl font-bold text-primary mb-2" id="average-rating">0.0</div>
                                        <div class="flex justify-center mb-2" id="rating-stars">
                                            <span class="text-yellow-400">☆☆☆☆☆</span>
                                        </div>
                                        <p class="text-sm text-gray-600"><span id="total-reviews">0</span> ta sharh</p>
                                    </div>
                                    <div class="space-y-2" id="rating-breakdown">
                                        <!-- Rating breakdown will be loaded here -->
                                    </div>
                                </div>
                            </div>

                            <!-- Write Review -->
                            <div class="border-t pt-6">
                                <button onclick="writeReview()" class="btn btn-primary">
                                    Sharh yozish
                                </button>
                            </div>

                            <!-- Reviews List -->
                            <div class="space-y-4" id="reviews-list">
                                <!-- Reviews will be loaded here -->
                            </div>
                        </div>
                    </div>

                    <!-- Delivery Tab -->
                    <div id="delivery-tab" class="tab-content hidden">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <h3 class="font-semibold mb-4">Yetkazib berish variantlari</h3>
                                <div class="space-y-4">
                                    <div class="border rounded-lg p-4">
                                        <div class="flex justify-between items-start mb-2">
                                            <h4 class="font-medium">Standart yetkazib berish</h4>
                                            <span class="text-primary font-semibold">15,000 so'm</span>
                                        </div>
                                        <p class="text-sm text-gray-600">2-3 ish kuni ichida yetkazib berish</p>
                                    </div>

                                    <div class="border rounded-lg p-4">
                                        <div class="flex justify-between items-start mb-2">
                                            <h4 class="font-medium">Tez yetkazib berish</h4>
                                            <span class="text-primary font-semibold">25,000 so'm</span>
                                        </div>
                                        <p class="text-sm text-gray-600">1 ish kuni ichida yetkazib berish</p>
                                    </div>

                                    <div class="border rounded-lg p-4 bg-green-50 border-green-200">
                                        <div class="flex justify-between items-start mb-2">
                                            <h4 class="font-medium">Bepul yetkazib berish</h4>
                                            <span class="text-green-600 font-semibold">Bepul</span>
                                        </div>
                                        <p class="text-sm text-gray-600">50,000 so'mdan yuqori xaridlarda bepul</p>
                                    </div>
                                </div>
                            </div>

                            <div>
                                <h3 class="font-semibold mb-4">Qaytarish siyosati</h3>
                                <div class="space-y-3 text-sm">
                                    <p>• 14 kun ichida qaytarish mumkin</p>
                                    <p>• Mahsulot asl holatida bo'lishi kerak</p>
                                    <p>• Qaytarish uchun chek zarur</p>
                                    <p>• Oziq-ovqat mahsulotlari qaytarilmaydi</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Related Products -->
            <div class="mt-12">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">O'xshash mahsulotlar</h2>
                <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-4" id="related-products">
                    <!-- Related products will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Product Not Found -->
        <div id="product-not-found" class="text-center py-12 hidden">
            <svg class="w-16 h-16 mx-auto mb-4 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"/>
            </svg>
            <h3 class="text-lg font-semibold text-gray-700 mb-2">Mahsulot topilmadi</h3>
            <p class="text-gray-500 mb-4">Kechirasiz, bu mahsulot mavjud emas yoki o'chirilgan</p>
            <a href="index.html" class="btn btn-primary">
                Bosh sahifaga qaytish
            </a>
        </div>
    </main>

    <!-- Fixed Bottom Actions (Mobile) -->
    <div class="md:hidden fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 p-4 z-50">
        <div class="flex space-x-3">
            <button onclick="toggleFavorite()" class="p-3 border border-gray-300 rounded-lg">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                </svg>
            </button>
            <button onclick="addToCart()" class="flex-1 btn btn-primary py-3 font-semibold">
                Savatga qo'shish
            </button>
            <button onclick="buyNow()" class="px-6 btn btn-outline py-3 font-semibold">
                Sotib olish
            </button>
        </div>
    </div>

    <!-- Review Modal -->
    <div id="review-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-2xl w-full max-w-md p-6">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-semibold">Sharh yozish</h3>
                <button onclick="closeReviewModal()" class="p-2 hover:bg-gray-100 rounded-lg">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>

            <form onsubmit="submitReview(event)" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium mb-2">Reyting</label>
                    <div class="flex space-x-1" id="rating-input">
                        <button type="button" onclick="setRating(1)" class="rating-star text-2xl text-gray-300">★</button>
                        <button type="button" onclick="setRating(2)" class="rating-star text-2xl text-gray-300">★</button>
                        <button type="button" onclick="setRating(3)" class="rating-star text-2xl text-gray-300">★</button>
                        <button type="button" onclick="setRating(4)" class="rating-star text-2xl text-gray-300">★</button>
                        <button type="button" onclick="setRating(5)" class="rating-star text-2xl text-gray-300">★</button>
                    </div>
                    <input type="hidden" id="selected-rating" value="0">
                </div>

                <div>
                    <label for="review-text" class="block text-sm font-medium mb-2">Sharh matni</label>
                    <textarea id="review-text" rows="4"
                              placeholder="Mahsulot haqida fikringizni yozing..."
                              class="form-input" required></textarea>
                </div>

                <div class="flex space-x-3">
                    <button type="button" onclick="closeReviewModal()" class="flex-1 btn btn-secondary">
                        Bekor qilish
                    </button>
                    <button type="submit" class="flex-1 btn btn-primary">
                        Yuborish
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Demo product data
        const productData = {
            1: {
                id: 1,
                name: "Toza olma",
                slug: "toza-olma",
                price: 8000,
                originalPrice: 10000,
                image: "🍎",
                images: ["🍎", "🍏", "🍎", "🍏"],
                category: "fruits",
                categoryName: "Mevalar",
                unit: "kg",
                rating: 4.5,
                reviews: 24,
                inStock: true,
                stockQuantity: 50,
                featured: true,
                brand: "Mahalliy fermer",
                sku: "FR001",
                description: "Toza va sifatli olma. Vitaminlar bilan boy. Har kuni iste'mol qilish uchun juda foydali. Bizning mahalliy fermerlarimizdan to'g'ridan-to'g'ri olingan. Hech qanday kimyoviy moddalar ishlatilmagan.",
                specifications: {
                    "Kelib chiqishi": "O'zbekiston",
                    "Saqlash muddati": "2 hafta",
                    "Saqlash sharoiti": "Sovuq joyda",
                    "Kaloriya": "52 kcal/100g",
                    "Protein": "0.3g",
                    "Yog'": "0.2g",
                    "Karbohidrat": "14g"
                },
                relatedProducts: [2, 6, 7]
            }
        };

        let currentProduct = null;
        let selectedRating = 0;
        let quantity = 1;
        let isFavorite = false;

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            loadProduct();
            updateCartCount();
        });

        function loadProduct() {
            const urlParams = new URLSearchParams(window.location.search);
            const productSlug = urlParams.get('product');

            if (!productSlug) {
                showProductNotFound();
                return;
            }

            // Find product by slug (demo data only has ID 1)
            const productId = 1; // In real app, you'd look up by slug
            currentProduct = productData[productId];

            if (!currentProduct) {
                showProductNotFound();
                return;
            }

            displayProduct(currentProduct);
            loadRelatedProducts();

            setTimeout(() => {
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('product-content').classList.remove('hidden');
            }, 800);
        }

        function displayProduct(product) {
            // Update header
            document.getElementById('product-name').textContent = product.name;
            document.getElementById('product-category').textContent = product.categoryName;

            // Update breadcrumb
            document.getElementById('breadcrumb-category').textContent = product.categoryName;
            document.getElementById('breadcrumb-category').href = `products.html?category=${product.category}`;
            document.getElementById('breadcrumb-product').textContent = product.name;

            // Update main image
            document.getElementById('main-image').textContent = product.image;

            // Update thumbnails
            const thumbnailsContainer = document.getElementById('thumbnail-images');
            thumbnailsContainer.innerHTML = product.images.map((img, index) => `
                <button onclick="changeMainImage('${img}')"
                        class="aspect-square bg-gray-100 rounded-lg flex items-center justify-center text-2xl hover:bg-gray-200 transition-colors ${index === 0 ? 'ring-2 ring-primary' : ''}">
                    ${img}
                </button>
            `).join('');

            // Update badges
            const badgesContainer = document.getElementById('product-badges');
            badgesContainer.innerHTML = '';

            if (product.originalPrice && product.originalPrice > product.price) {
                const discountPercent = Math.round(((product.originalPrice - product.price) / product.originalPrice) * 100);
                badgesContainer.innerHTML += `<div class="bg-red-500 text-white text-xs px-2 py-1 rounded-full">-${discountPercent}%</div>`;
            }

            if (product.featured) {
                badgesContainer.innerHTML += `<div class="bg-primary text-white text-xs px-2 py-1 rounded-full">Top</div>`;
            }

            // Update product info
            document.getElementById('product-title').textContent = product.name;
            document.getElementById('product-sku').textContent = `SKU: ${product.sku}`;
            document.getElementById('product-brand').textContent = product.brand;

            // Update rating
            const ratingContainer = document.getElementById('product-rating');
            const stars = '★'.repeat(Math.floor(product.rating)) + '☆'.repeat(5 - Math.floor(product.rating));
            ratingContainer.innerHTML = `
                <div class="flex text-yellow-400">${stars}</div>
                <span class="ml-2 text-sm text-gray-600">${product.rating} (${product.reviews} ta sharh)</span>
            `;

            // Update stock status
            const stockStatus = document.getElementById('stock-status');
            if (product.inStock) {
                stockStatus.innerHTML = '✅ Mavjud';
                stockStatus.className = 'px-3 py-1 bg-green-100 text-green-800 text-sm rounded-full';
            } else {
                stockStatus.innerHTML = '❌ Tugagan';
                stockStatus.className = 'px-3 py-1 bg-red-100 text-red-800 text-sm rounded-full';
            }

            // Update prices
            document.getElementById('current-price').textContent = product.price.toLocaleString() + ' so\'m';
            document.getElementById('price-unit').textContent = product.unit;

            if (product.originalPrice && product.originalPrice > product.price) {
                document.getElementById('original-price').textContent = product.originalPrice.toLocaleString() + ' so\'m';
                document.getElementById('original-price').classList.remove('hidden');

                const discountPercent = Math.round(((product.originalPrice - product.price) / product.originalPrice) * 100);
                document.getElementById('discount-percent').textContent = `-${discountPercent}%`;
                document.getElementById('discount-percent').classList.remove('hidden');
            }

            updateTotalPrice();

            // Update tab content
            document.getElementById('product-description').innerHTML = `
                <p>${product.description}</p>
                <h4 class="font-semibold mt-4 mb-2">Foydali xususiyatlari:</h4>
                <ul class="list-disc list-inside space-y-1">
                    <li>Vitaminlar bilan boy</li>
                    <li>Tabiiy va organik</li>
                    <li>Har kuni iste'mol qilish mumkin</li>
                    <li>Kimyoviy moddalar ishlatilmagan</li>
                </ul>
            `;

            // Update specifications
            const specsContainer = document.getElementById('product-specifications');
            specsContainer.innerHTML = Object.entries(product.specifications).map(([key, value]) => `
                <div class="flex justify-between py-2 border-b border-gray-200">
                    <span class="font-medium">${key}:</span>
                    <span>${value}</span>
                </div>
            `).join('');

            // Update reviews
            document.getElementById('reviews-count').textContent = `(${product.reviews})`;
            loadReviews();

            // Update buttons state
            updateButtonsState();
        }

        function changeMainImage(imageSrc) {
            document.getElementById('main-image').textContent = imageSrc;

            // Update thumbnail active state
            const thumbnails = document.querySelectorAll('#thumbnail-images button');
            thumbnails.forEach((thumb, index) => {
                if (thumb.textContent.trim() === imageSrc) {
                    thumb.classList.add('ring-2', 'ring-primary');
                } else {
                    thumb.classList.remove('ring-2', 'ring-primary');
                }
            });
        }

        function updateButtonsState() {
            const addToCartBtn = document.getElementById('add-to-cart-btn');

            if (!currentProduct.inStock) {
                addToCartBtn.textContent = 'Tugagan';
                addToCartBtn.disabled = true;
                addToCartBtn.classList.add('opacity-50', 'cursor-not-allowed');

                document.getElementById('quantity').disabled = true;
            }
        }

        function switchTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active', 'border-primary', 'text-primary');
                button.classList.add('border-transparent', 'text-gray-500');
            });

            event.target.classList.add('active', 'border-primary', 'text-primary');
            event.target.classList.remove('border-transparent', 'text-gray-500');

            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
            });

            document.getElementById(`${tabName}-tab`).classList.remove('hidden');
        }

        function increaseQuantity() {
            if (quantity < 10 && currentProduct.inStock) {
                quantity++;
                document.getElementById('quantity').value = quantity;
                updateTotalPrice();
            }
        }

        function decreaseQuantity() {
            if (quantity > 1) {
                quantity--;
                document.getElementById('quantity').value = quantity;
                updateTotalPrice();
            }
        }

        function updateQuantity() {
            const input = document.getElementById('quantity');
            const newQuantity = parseInt(input.value);

            if (newQuantity >= 1 && newQuantity <= 10) {
                quantity = newQuantity;
                updateTotalPrice();
            } else {
                input.value = quantity;
            }
        }

        function updateTotalPrice() {
            if (currentProduct) {
                const total = currentProduct.price * quantity;
                document.getElementById('total-price').textContent = total.toLocaleString() + ' so\'m';
            }
        }

        function addToCart() {
            if (!currentProduct || !currentProduct.inStock) {
                showNotification('Mahsulot mavjud emas', 'error');
                return;
            }

            let cart = JSON.parse(localStorage.getItem('cart') || '[]');
            const existingItem = cart.find(item => item.id === currentProduct.id);

            if (existingItem) {
                existingItem.quantity += quantity;
            } else {
                cart.push({...currentProduct, quantity: quantity});
            }

            localStorage.setItem('cart', JSON.stringify(cart));
            updateCartCount();
            showNotification(`${currentProduct.name} savatga qo'shildi!`, 'success');
        }

        function buyNow() {
            addToCart();
            setTimeout(() => {
                window.location.href = 'cart.html';
            }, 500);
        }

        function toggleFavorite() {
            isFavorite = !isFavorite;
            const favoriteBtn = document.getElementById('favorite-btn');

            if (isFavorite) {
                favoriteBtn.innerHTML = `
                    <svg class="w-6 h-6 text-red-500" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                    </svg>
                `;
                showNotification('Sevimlilar ro\'yxatiga qo\'shildi', 'success');
            } else {
                favoriteBtn.innerHTML = `
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                    </svg>
                `;
                showNotification('Sevimlilardan o\'chirildi', 'info');
            }
        }

        function shareProduct() {
            if (navigator.share && currentProduct) {
                navigator.share({
                    title: currentProduct.name,
                    text: `${currentProduct.name} - ${currentProduct.price.toLocaleString()} so'm`,
                    url: window.location.href
                });
            } else {
                // Fallback - copy URL to clipboard
                navigator.clipboard.writeText(window.location.href);
                showNotification('Havola nusxalandi!', 'success');
            }
        }

        function loadReviews() {
            // Demo reviews data
            const reviews = [
                {
                    id: 1,
                    author: "Ahmad Karimov",
                    rating: 5,
                    date: "2024-01-15",
                    text: "Juda sifatli mahsulot. Tavsiya qilaman!"
                },
                {
                    id: 2,
                    author: "Malika Tosheva",
                    rating: 4,
                    date: "2024-01-10",
                    text: "Yaxshi mahsulot, lekin narxi biroz qimmat."
                }
            ];

            // Update summary
            document.getElementById('average-rating').textContent = currentProduct.rating.toFixed(1);
            document.getElementById('total-reviews').textContent = reviews.length;
            document.getElementById('rating-stars').innerHTML = `<span class="text-yellow-400">${'★'.repeat(Math.floor(currentProduct.rating))}${'☆'.repeat(5 - Math.floor(currentProduct.rating))}</span>`;

            // Update rating breakdown
            const breakdown = document.getElementById('rating-breakdown');
            breakdown.innerHTML = [5,4,3,2,1].map(star => {
                const count = reviews.filter(r => r.rating === star).length;
                const percentage = reviews.length > 0 ? (count / reviews.length) * 100 : 0;
                return `
                    <div class="flex items-center space-x-2 text-sm">
                        <span>${star} ★</span>
                        <div class="flex-1 bg-gray-200 rounded-full h-2">
                            <div class="bg-yellow-400 h-2 rounded-full" style="width: ${percentage}%"></div>
                        </div>
                        <span class="text-gray-500">${count}</span>
                    </div>
                `;
            }).join('');

            // Update reviews list
            const reviewsList = document.getElementById('reviews-list');
            reviewsList.innerHTML = reviews.map(review => `
                <div class="border rounded-lg p-4">
                    <div class="flex items-center justify-between mb-2">
                        <div class="flex items-center space-x-2">
                            <div class="w-8 h-8 bg-primary rounded-full flex items-center justify-center text-white text-sm font-semibold">
                                ${review.author.charAt(0)}
                            </div>
                            <div>
                                <p class="font-medium text-sm">${review.author}</p>
                                <p class="text-xs text-gray-500">${new Date(review.date).toLocaleDateString('uz-UZ')}</p>
                            </div>
                        </div>
                        <div class="text-yellow-400">
                            ${'★'.repeat(review.rating)}${'☆'.repeat(5 - review.rating)}
                        </div>
                    </div>
                    <p class="text-gray-700">${review.text}</p>
                </div>
            `).join('');
        }

        function writeReview() {
            document.getElementById('review-modal').classList.remove('hidden');
        }

        function closeReviewModal() {
            document.getElementById('review-modal').classList.add('hidden');
            selectedRating = 0;
            document.getElementById('review-text').value = '';
            updateRatingStars();
        }

        function setRating(rating) {
            selectedRating = rating;
            document.getElementById('selected-rating').value = rating;
            updateRatingStars();
        }

        function updateRatingStars() {
            const stars = document.querySelectorAll('.rating-star');
            stars.forEach((star, index) => {
                if (index < selectedRating) {
                    star.classList.add('text-yellow-400');
                    star.classList.remove('text-gray-300');
                } else {
                    star.classList.add('text-gray-300');
                    star.classList.remove('text-yellow-400');
                }
            });
        }

        function submitReview(event) {
            event.preventDefault();

            if (selectedRating === 0) {
                showNotification('Reyting tanlang', 'error');
                return;
            }

            const reviewText = document.getElementById('review-text').value;
            if (!reviewText.trim()) {
                showNotification('Sharh matnini kiriting', 'error');
                return;
            }

            // Here you would submit the review to the API
            showNotification('Sharhingiz uchun rahmat!', 'success');
            closeReviewModal();
        }

        function loadRelatedProducts() {
            const relatedContainer = document.getElementById('related-products');

            // Demo related products
            const relatedProducts = [
                { id: 2, name: "Yangi pomidor", price: 12000, image: "🍅", category: "Sabzavotlar" },
                { id: 6, name: "Shirin banan", price: 18000, image: "🍌", category: "Mevalar" },
                { id: 7, name: "Organik sabzi", price: 15000, image: "🥕", category: "Sabzavotlar" },
                { id: 8, name: "Toza apelsin", price: 16000, image: "🍊", category: "Mevalar" }
            ];

            relatedContainer.innerHTML = relatedProducts.map(product => `
                <div class="bg-white rounded-xl border border-gray-200 p-3 hover:shadow-md transition-shadow cursor-pointer" onclick="openProduct('${product.slug || 'product-' + product.id}')">
                    <div class="aspect-square bg-gray-100 rounded-lg flex items-center justify-center text-3xl mb-3">
                        ${product.image}
                    </div>
                    <h3 class="font-medium text-sm mb-1 truncate">${product.name}</h3>
                    <p class="text-xs text-gray-500 mb-2">${product.category}</p>
                    <div class="flex items-center justify-between">
                        <span class="font-semibold text-primary text-sm">${product.price.toLocaleString()} so'm</span>
                        <button onclick="addRelatedToCart(event, ${product.id})" class="p-1 text-primary hover:bg-primary hover:text-white rounded transition-colors">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                            </svg>
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function openProduct(slug) {
            window.location.href = `product-detail.html?product=${slug}`;
        }

        function addRelatedToCart(event, productId) {
            event.stopPropagation();
            showNotification('Mahsulot savatga qo\'shildi!', 'success');
        }

        function showProductNotFound() {
            document.getElementById('loading').classList.add('hidden');
            document.getElementById('product-not-found').classList.remove('hidden');
        }

        function goBack() {
            if (document.referrer) {
                history.back();
            } else {
                window.location.href = 'index.html';
            }
        }

        function updateCartCount() {
            const cart = JSON.parse(localStorage.getItem('cart') || '[]');
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            document.getElementById('cart-count').textContent = totalItems;
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;

            document.body.appendChild(notification);

            setTimeout(() => {
                notification.classList.add('show');
            }, 100);

            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    if (notification.parentNode) {
                        document.body.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }
    </script>
</body>
</html>
